module.exports=function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var r="undefined"!=typeof Float64Array?Float64Array:Array;Math.random;Math.PI;function n(t,e,i,r){var n=e[0],o=e[1];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t}var o,a,s=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)};(o=new r(2))[0]=0,o[1]=0,a=o;function u(t,e,i,r,n,o){if(!(n-r<=i)){var a=r+n>>1;!function t(e,i,r,n,o,a){for(;o>n;){if(o-n>600){var s=o-n+1,u=r-n+1,f=Math.log(s),p=.5*Math.exp(2*f/3),l=.5*Math.sqrt(f*p*(s-p)/s)*(u-s/2<0?-1:1),c=Math.max(n,Math.floor(r-u*p/s+l)),d=Math.min(o,Math.floor(r+(s-u)*p/s+l));t(e,i,r,c,d,a)}var m=i[2*r+a],v=n,_=o;for(h(e,i,n,r),i[2*o+a]>m&&h(e,i,n,o);v<_;){for(h(e,i,v,_),v++,_--;i[2*v+a]<m;)v++;for(;i[2*_+a]>m;)_--}i[2*n+a]===m?h(e,i,n,_):(_++,h(e,i,_,o)),_<=r&&(n=_+1),r<=_&&(o=_-1)}}(t,e,a,r,n,o%2),u(t,e,i,r,a-1,o+1),u(t,e,i,a+1,n,o+1)}}function h(t,e,i,r){f(t,i,r),f(e,2*i,2*r),f(e,2*i+1,2*r+1)}function f(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function p(t,e,i,r){var n=t-i,o=e-r;return n*n+o*o}var l=function(t){return t[0]},c=function(t){return t[1]},d=function(){function t(t,e,i,r,n){void 0===e&&(e=l),void 0===i&&(i=c),void 0===r&&(r=64),void 0===n&&(n=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new n(2*t.length),h=0;h<t.length;h++)a[h]=h,s[2*h]=e(t[h]),s[2*h+1]=i(t[h]);u(a,s,r,0,a.length-1,0)}return t.prototype.range=function(t,e,i,r){return function(t,e,i,r,n,o,a){for(var s,u,h=[0,t.length-1,0],f=[];h.length;){var p=h.pop(),l=h.pop(),c=h.pop();if(l-c<=a)for(var d=c;d<=l;d++)s=e[2*d],u=e[2*d+1],s>=i&&s<=n&&u>=r&&u<=o&&f.push(t[d]);else{var m=Math.floor((c+l)/2);s=e[2*m],u=e[2*m+1],s>=i&&s<=n&&u>=r&&u<=o&&f.push(t[m]);var v=(p+1)%2;(0===p?i<=s:r<=u)&&(h.push(c),h.push(m-1),h.push(v)),(0===p?n>=s:o>=u)&&(h.push(m+1),h.push(l),h.push(v))}}return f}(this.ids,this.coords,t,e,i,r,this.nodeSize)},t.prototype.within=function(t,e,i){return function(t,e,i,r,n,o){for(var a=[0,t.length-1,0],s=[],u=n*n;a.length;){var h=a.pop(),f=a.pop(),l=a.pop();if(f-l<=o)for(var c=l;c<=f;c++)p(e[2*c],e[2*c+1],i,r)<=u&&s.push(t[c]);else{var d=Math.floor((l+f)/2),m=e[2*d],v=e[2*d+1];p(m,v,i,r)<=u&&s.push(t[d]);var _=(h+1)%2;(0===h?i-n<=m:r-n<=v)&&(a.push(l),a.push(d-1),a.push(_)),(0===h?i+n>=m:r+n>=v)&&(a.push(d+1),a.push(f),a.push(_))}}return s}(this.ids,this.coords,t,e,i,this.nodeSize)},t}();function m(t,e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],f=e[7],p=e[8],l=e[9],c=e[10],d=e[11],m=e[12],v=e[13],_=e[14],g=e[15],y=i[0],x=i[1],E=i[2],b=i[3];return t[0]=y*r+x*s+E*p+b*m,t[1]=y*n+x*u+E*l+b*v,t[2]=y*o+x*h+E*c+b*_,t[3]=y*a+x*f+E*d+b*g,y=i[4],x=i[5],E=i[6],b=i[7],t[4]=y*r+x*s+E*p+b*m,t[5]=y*n+x*u+E*l+b*v,t[6]=y*o+x*h+E*c+b*_,t[7]=y*a+x*f+E*d+b*g,y=i[8],x=i[9],E=i[10],b=i[11],t[8]=y*r+x*s+E*p+b*m,t[9]=y*n+x*u+E*l+b*v,t[10]=y*o+x*h+E*c+b*_,t[11]=y*a+x*f+E*d+b*g,y=i[12],x=i[13],E=i[14],b=i[15],t[12]=y*r+x*s+E*p+b*m,t[13]=y*n+x*u+E*l+b*v,t[14]=y*o+x*h+E*c+b*_,t[15]=y*a+x*f+E*d+b*g,t}var v=function(){function t(t){this.name=t.name,this.index=t.index,this.location=void 0!==t.location?t.location:-1,this._enable=!1}return t.prototype.bindLocation=function(t,e){return-1!==this.location&&!0!==this.index&&t.bindAttribLocation(e,this.location,this.name),this},t.prototype.getLocation=function(t,e){return-1===this.location&&!0!==this.index&&(this.location=t.getAttribLocation(e,this.name)),this},t.prototype.bind=function(t,e){return this._enable||!0===this.index||(t.enableVertexAttribArray(this.location),this._enable=!0),e.bind(t,this.location),this},t.prototype.disable=function(t){return this._enable&&!0!==this.index&&(t.disableVertexAttribArray(this.location),this._enable=!1),this},t}(),_=function(){function t(t){this.name=t.name,this.type=t.type,this.location=-1}return t.prototype.getLocation=function(t,e){return this.location=t.getUniformLocation(e,this.name),this},t.prototype.bind=function(t,e){var i=this.type;return"mat2"===i?t.uniformMatrix2fv(this.location,!1,e):"mat3"===i?t.uniformMatrix3fv(this.location,!1,e):"mat4"===i?t.uniformMatrix4fv(this.location,!1,e):"2f"===i?t.uniform2f(this.location,e[0],e[1]):"3f"===i?t.uniform3f(this.location,e[0],e[1],e[2]):"4f"===i?t.uniform4f(this.location,e[0],e[1],e[2],e[3]):"2i"===i?t.uniform2i(this.location,e[0],e[1]):"3i"===i?t.uniform3i(this.location,e[0],e[1],e[2]):"4i"===i?t.uniform4i(this.location,e[0],e[1],e[2],e[3]):t["uniform"+i](this.location,e),this},t}(),g=function(){function t(t){var e=this;t=t||{},this._vertexShader=t.vertex,this._fragmentShader=t.fragment,this.uniforms={},t.uniforms=t.uniforms||[],t.uniforms.forEach((function(t){e.uniforms[t.name]=new _(t)})),this.attributes={},t.attributes=t.attributes||[],t.attributes.forEach((function(t){e.attributes[t.name]=new v(t)})),this._linked=!1,this._located=!1}return t.prototype.enable=function(t){return this.link(t),this.locate(t),t.useProgram(this._webglProgram),this},t.prototype.bind=function(t,e,i){if(e)for(var r in e)this.uniforms[r].bind(t,e[r]);if(i)for(var r in i)this.attributes[r].bind(t,i[r]);return this},t.prototype.disable=function(t){for(var e in this.attributes)this.attributes[e].disable(t);return this},t.prototype.link=function(t){if(this._linked)return this;for(var e in this._webglProgram=t.createProgram(),this._vertexShader&&t.attachShader(this._webglProgram,this._vertexShader.get(t)),this._fragmentShader&&t.attachShader(this._webglProgram,this._fragmentShader.get(t)),this.attributes)this.attributes[e].bindLocation(t,this._webglProgram);return t.linkProgram(this._webglProgram),this._linked=!0,this},t.prototype.locate=function(t){if(this._located)return this;for(var e in this.attributes)this.attributes[e].getLocation(t,this._webglProgram);for(var e in this.uniforms)this.uniforms[e].getLocation(t,this._webglProgram);return this._located=!0,this},t}(),y=function(){function t(e,i){void 0===i&&(i={}),this._src=e||null,this.options=Object.assign({},t.defaultOptions,i),this._glContext=null}return t.prototype.enable=function(t,e){var i=void 0!==e?e:this.options.unit;return void 0!==i&&t.activeTexture(t.TEXTURE0+i),this._texture||this.prepare(t),t.bindTexture(t.TEXTURE_2D,this._texture),this},t.prototype.remove=function(){return this._texture&&(this._glContext.deleteTexture(this._texture),this._glContext=null,this._texture=null),this},t.prototype.getTexture=function(){return this._texture},t.prototype.subImage=function(t,e,i,r){return t.bindTexture(t.TEXTURE_2D,this._texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.options.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),t.texSubImage2D(t.TEXTURE_2D,0,i,r,this._toGlParam(t,this.options.format),t.UNSIGNED_BYTE,e),this},t.prototype.prepare=function(e){return this._glContext=e,this._texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.options.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),this.options.size?e.texImage2D(e.TEXTURE_2D,0,this._toGlParam(e,this.options.format),this.options.size[0],this.options.size[1],0,this._toGlParam(e,this.options.format),e.UNSIGNED_BYTE,this._src):e.texImage2D(e.TEXTURE_2D,0,this._toGlParam(e,this.options.format),this._toGlParam(e,this.options.format),e.UNSIGNED_BYTE,this._src),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._toGlParam(e,this.options.wrapS)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._toGlParam(e,this.options.wrapT)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this._toGlParam(e,this.options.magFilter)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._toGlParam(e,this.options.minFilter)),this.options.generateMipmaps&&this.options.minFilter!==t.NearestFilter&&this.options.minFilter!==t.LinearFilter&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),this},t.prototype._toGlParam=function(e,i){return i===t.ClampToEdgeWrapping?e.CLAMP_TO_EDGE:i===t.Repeat?e.REPEAT:i===t.MirroredRepeat?e.MIRRORED_REPEAT:i===t.NearestFilter?e.NEAREST:i===t.NearestMipMapNearestFilter?e.NEAREST_MIPMAP_NEAREST:i===t.NearestMipMapLinearFilter?e.NEAREST_MIPMAP_LINEAR:i===t.LinearFilter?e.LINEAR:i===t.LinearMipMapNearestFilter?e.LINEAR_MIPMAP_NEAREST:i===t.LinearMipMapLinearFilter?e.LINEAR_MIPMAP_LINEAR:i===t.RgbaFormat?e.RGBA:i===t.AlphaFormat?e.ALPHA:i===t.RgbFormat?e.RGB:null},t}();y.ClampToEdgeWrapping=8,y.Repeat=9,y.MirroredRepeat=10,y.NearestFilter=1,y.NearestMipMapNearestFilter=2,y.NearestMipMapLinearFilter=3,y.LinearFilter=4,y.LinearMipMapNearestFilter=5,y.LinearMipMapLinearFilter=6,y.RgbaFormat=11,y.AlphaFormat=12,y.RgbFormat=13,y.defaultOptions={magFilter:y.LinearFilter,minFilter:y.LinearMipMapLinearFilter,wrapS:y.ClampToEdgeWrapping,wrapT:y.ClampToEdgeWrapping,format:y.RgbaFormat,generateMipmaps:!0,flipY:!0,premultiplyAlpha:!0};var x=y,E=function(){function t(e,i,r){void 0===r&&(r=[]),this.type="vertex"===e?t.Vertex:t.Fragment,this._code=Array.isArray(i)?i.join("\n"):i||"",this._code=r.map((function(t){return void 0!==t.value?"#define "+t.type+" "+t.value:"#define "+t.type})).join("\n")+"\n"+this._code}return t.prototype.get=function(t){return this._shader||this._compile(t),this._shader},t.prototype.remove=function(t){this._shader&&t.deleteShader(this._shader)},t.prototype._compile=function(e){var i=this.type===t.Vertex?e.VERTEX_SHADER:e.FRAGMENT_SHADER,r=this._shader=e.createShader(i);e.shaderSource(r,this._code),e.compileShader(r)},t}();E.Vertex=1,E.Fragment=2;var b=E,T=function(){function t(e,i){this._initData=e,this.byteLength=void 0!==e.byteLength?e.byteLength:e,this.type=t.ArrayBuffer,this.drawType=t.StaticDraw,this.options=Object.assign({},t.defaultOptions,i),this._glBuffer=null,this._glContext=null}return t.prototype.bind=function(e,i,r){return this._glBuffer||this.prepare(e),this.type===t.ArrayBuffer?(e.bindBuffer(e.ARRAY_BUFFER,this._glBuffer),r=r||this.options,e.vertexAttribPointer(i,r.itemSize,this._toGlParam(e,r.dataType),r.normalized,r.stride,r.offset)):this.type===t.ElementArrayBuffer&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._glBuffer),this},t.prototype.remove=function(){return this._unprepare(),this},t.prototype.subData=function(t,e,i){return t.bindBuffer(this._toGlParam(t,this.type),this._glBuffer),t.bufferSubData(this._toGlParam(t,this.type),e,i),this},t.prototype.prepare=function(t){return this._glContext=t,this._glBuffer=t.createBuffer(),t.bindBuffer(this._toGlParam(t,this.type),this._glBuffer),t.bufferData(this._toGlParam(t,this.type),this._initData,this._toGlParam(t,this.drawType)),this._initData=null,this},t.prototype._unprepare=function(){this._glBuffer&&(this._glContext.deleteBuffer(this._glBuffer),this._glBuffer=null,this._glContext=null)},t.prototype._toGlParam=function(e,i){return i===t.ArrayBuffer?e.ARRAY_BUFFER:i===t.ElementArrayBuffer?e.ELEMENT_ARRAY_BUFFER:i===t.StaticDraw?e.STATIC_DRAW:i===t.DynamicDraw?e.DYNAMIC_DRAW:i===t.Byte?e.BYTE:i===t.Short?e.SHORT:i===t.Int?e.INT:i===t.Float?e.FLOAT:i===t.UnsignedByte?e.UNSIGNED_BYTE:i===t.UnsignedShort?e.UNSIGNED_SHORT:i===t.UnsignedInt?e.UNSIGNED_INT:null},t}();T.ArrayBuffer=1,T.ElementArrayBuffer=2,T.StaticDraw=10,T.DynamicDraw=11,T.Float=20,T.UnsignedByte=21,T.UnsignedShort=22,T.UnsignedInt=23,T.Byte=24,T.Short=25,T.Int=26,T.defaultOptions={itemSize:3,dataType:T.Float,stride:0,offset:0,normalized:!1};var S=T,A=function(){function t(t,e){void 0===e&&(e={}),this._vao=null,this._attributes=e,this._shaderProgram=t,this._ext=null}return t.prototype.bind=function(t){var e=t.extensions.OES_vertex_array_object;return e?this._bind(t.gl,e):this._shaderProgram.bind(t.gl,null,this._attributes),this},t.prototype.unbind=function(){return this._ext&&this._ext.bindVertexArrayOES(null),this},t.prototype.remove=function(){return this._vao&&this._ext.deleteVertexArrayOES(this._vao),this},t.prototype._bind=function(t,e){this._vao?e.bindVertexArrayOES(this._vao):this._prepare(t,e)},t.prototype._prepare=function(t,e){this._ext=e,this._vao=e.createVertexArrayOES(),e.bindVertexArrayOES(this._vao);var i=this._shaderProgram.attributes,r=this._attributes;for(var n in r){var o=i[n];!0!==o.index&&t.enableVertexAttribArray(o.location),r[n].bind(t,o.location)}},t}(),w=new Float32Array(16),P=[512,512],R=function(){function t(t,e){var i=this;this.renderContext=t,this.matrix=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(),this.points=[],this.vertexCount=0,this.min=[0,0],this.max=[0,0],this.program=new g({vertex:new b("vertex","\n    attribute vec2 a_position;\n    attribute vec2 a_offset;\n    attribute vec2 a_uv;\n\n    uniform mat4 u_mvp;\n    uniform vec2 u_size;\n\n    varying vec2 v_uv;\n\n    void main() {\n        v_uv = a_uv;\n        vec2 inv_half_size = 2.0 / u_size;\n        vec4 anchor = u_mvp * vec4(a_position, 0.0, 1.0);\n        vec2 pos_2d = anchor.xy + a_offset * inv_half_size * anchor.w;\n        gl_Position = vec4(pos_2d, anchor.z, anchor.w);\n    }\n"),fragment:new b("fragment","\n    precision mediump float;\n    uniform sampler2D u_texture;\n    varying vec2 v_uv;\n    void main() {\n        gl_FragColor = texture2D(u_texture, v_uv);\n    }\n"),attributes:[{name:"a_position"},{name:"a_offset"},{name:"a_uv"}],uniforms:[{name:"u_mvp",type:"mat4"},{name:"u_size",type:"2fv"},{name:"u_texture",type:"1i"}]}),this.atlas=function(t){for(var e=0,i=[],r=0;r<21;r++)i.push([]);t.forEach((function(t,r){for(var n,o=t.width,a=t.height,s="number"==typeof o?[[0,o]]:o,u="number"==typeof a?[[0,a]]:a,h=-1,f=0;f<s.length;f++){var p=s[f][0];e+=1;var l=s[f][1]*window.devicePixelRatio,c=u[f][1]*window.devicePixelRatio,d={x:e,y:1,w:l,h:c};e+=1+l;for(var m=h+1;m<=p;m++)i[m][r]=n||d;n=d,h=p}if(n)for(m=h+1;m<=20;m++)i[m][r]=n}));var n=t.map((function(t){return e=t.url,new Promise((function(t){var i=document.createElement("img");i.crossOrigin="Anonymous",i.onload=function(){return t(i)},i.src=e}));var e})),o=Promise.all(n).then((function(t){var e=document.createElement("canvas"),r=e.getContext("2d");return e.width=P[0],e.height=P[1],t.forEach((function(t,e){i.forEach((function(i){var n=i[e];r.drawImage(t,n.x,n.y,n.w,n.h)}))})),e}));return{icons:i,imagePromise:o}}(e),this.atlas.imagePromise.then((function(t){i.texture=new x(t,{flipY:!1,unit:0,magFilter:x.LinearFilter,minFilter:x.LinearFilter})}))}return t.prototype.setPoints=function(t,e,i){this.clear(),this.points=t,this.min=e,this.max=i;this.vertexCount=6*t.length;var r={array:new Float32Array(6*this.vertexCount),index:0},n={array:new Int16Array(2*this.vertexCount),index:0},o={array:new Uint16Array(2*this.vertexCount),index:0};this.data={position:r,offset:n,uv:o};var a=this.renderContext.gl;this.positionBuffer=new S(r.array,{itemSize:2,dataType:S.Float}),this.positionBuffer.drawType=S.DynamicDraw,this.positionBuffer.prepare(a),this.offsetBuffer=new S(n.array,{itemSize:2,dataType:S.Short}),this.offsetBuffer.drawType=S.DynamicDraw,this.offsetBuffer.prepare(a),this.uvBuffer=new S(o.array,{itemSize:2,dataType:S.UnsignedShort,normalized:!0}),this.uvBuffer.drawType=S.DynamicDraw,this.uvBuffer.prepare(a),this.vao=new A(this.program,{a_position:this.positionBuffer,a_offset:this.offsetBuffer,a_uv:this.uvBuffer})},t.prototype.render=function(t,e,i){if(this.vao&&this.texture){this.updatePoints(i);var r=this.renderContext.gl;r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),m(w,t,this.matrix),this.texture.enable(r),this.program.enable(r).bind(r,{u_mvp:w,u_size:[e[0]*window.devicePixelRatio,e[1]*window.devicePixelRatio],u_texture:0}),this.vao.bind(this.renderContext),this.vertexCount>0&&r.drawArrays(r.TRIANGLES,0,this.vertexCount)}},t.prototype.updatePoints=function(t){var e=this;if(this.data&&this.positionBuffer&&this.offsetBuffer&&this.uvBuffer){var i=this.data;i.position.index=0,i.offset.index=0,i.uv.index=0;var r=[this.max[0]-this.min[0],this.max[1]-this.min[1]];!function(t,e,i){t[0]=i[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=i[2],t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1}(this.matrix,[this.min[0],this.min[1],0],[r[0],r[1],1]);var n=this.atlas.icons[Math.floor(t)],o=P[0],a=P[1];this.points.forEach((function(t){var s=n[t.icon],u=(t.position[0]-e.min[0])/r[0],h=(t.position[1]-e.min[1])/r[1];M(i,u,h,-1,-1,0,0,s,o,a),M(i,u,h,-1,1,0,1,s,o,a),M(i,u,h,1,-1,1,0,s,o,a),M(i,u,h,1,1,1,1,s,o,a),M(i,u,h,1,-1,1,0,s,o,a),M(i,u,h,-1,1,0,1,s,o,a)}));var s=this.renderContext.gl;this.positionBuffer.subData(s,0,i.position.array),this.offsetBuffer.subData(s,0,i.offset.array),this.uvBuffer.subData(s,0,i.uv.array)}},t.prototype.clear=function(){var t,e,i,r;null===(t=this.vao)||void 0===t||t.remove(),null===(e=this.positionBuffer)||void 0===e||e.remove(),null===(i=this.uvBuffer)||void 0===i||i.remove(),null===(r=this.offsetBuffer)||void 0===r||r.remove()},t}();function M(t,e,i,r,n,o,a,s,u,h){var f=t.position,p=t.offset,l=t.uv;f.array[f.index++]=e,f.array[f.index++]=i,p.array[p.index++]=r*s.w/2,p.array[p.index++]=n*s.h/2,l.array[l.index++]=Math.floor((s.x+o*s.w)/u*65535),l.array[l.index++]=Math.floor((s.y+a*s.h)/h*65535)}var B=function(){function t(t,e){var i=this;this.map=t,this.updateSize=function(){var t=i.map.getSize();i.canvas.width=t[0]*window.devicePixelRatio,i.canvas.height=t[1]*window.devicePixelRatio,i.canvas.style.width=t[0]+"px",i.canvas.style.height=t[1]+"px",i.renderContext.gl.viewport(0,0,t[0]*window.devicePixelRatio,t[1]*window.devicePixelRatio)},this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",this.canvas.style.background="transparent",t.getContainer().appendChild(this.canvas),this.points=[];var r=this.canvas.getContext("webgl",{antialias:!0,alpha:!0}),n={OES_vertex_array_object:r.getExtension("OES_vertex_array_object")};this.renderContext={gl:r,extensions:n},window.addEventListener("resize",this.updateSize),this.updateSize(),r.clearColor(0,0,0,0),this.pointBatch=new R(this.renderContext,[e.virgin,e.disease,e.immune])}return t.prototype.setPoints=function(t,e,i){this.points=[],this.points=t.map((function(t){return{state:t.state,human:t,point:{icon:t.state,position:[t.coords[0],t.coords[1]]}}})),this.pointBatch.setPoints(this.points.map((function(t){return t.point})),e,i)},t.prototype.render=function(){for(var t=0;t<this.points.length;t++){var e=this.points[t],i=e.point,r=e.human;i.position[0]=r.coords[0],i.position[1]=r.coords[1],i.icon=r.state}var n=this.renderContext.gl;n.clear(n.COLOR_BUFFER_BIT),this.pointBatch.render(this.map.getProjectionMatrix(),this.map.getSize(),this.map.getZoom())},t}();function D(t,e,i){return t=Math.max(t,e),t=Math.min(t,i)}var F,L=Math.pow(2,32);function I(t){var e=L/2,i=Math.sin(t[1]*Math.PI/180),r=t[0]*L/360,n=Math.log((1+i)/(1-i))*L/(4*Math.PI);return[D(r,-e,e),D(n,-e,e),0]}function N(t){return function(){return((t=16807*t%2147483647)-1)/2147483646}}!function(t){t[t.Virgin=0]="Virgin",t[t.Disease=1]="Disease",t[t.Immune=2]="Immune"}(F||(F={}));function C(t){switch(t){case 0:return"road";case 1:return"house";case 3:return"null"}return"road"}var U=function(){function t(t,e){var i=this;this.options={randomSeed:15,diseaseRange:1,immunityAfter:15,waitAtHome:2,timeOutside:5,humansCount:4e3,humansStop:0,diseaseStartCount:50,humanSpeed:100,dataUrl:"",humanDeviation:.5},this.update=function(){requestAnimationFrame(i.update);var t=i.graph;if(t&&!i.paused){i.simulationTime+=16*i.speed,i.humans.forEach((function(e){return function(t,e,i,r,o){r.state===F.Disease&&o-r.diseaseStart>1e3*r.immunityAfter&&(r.state=F.Immune);if(r.stoped||z(r,o))return void(r.startTime=o);for(var a=t.edges[r.edge],u=a.geometry,h=i.humanSpeed*(o-r.startTime),f=r.passed,p=!0,l=r.segment;l<u.length-1;l++){var c=r.forward?u[l]:u[u.length-1-l],d=r.forward?u[l+1]:u[u.length-1-(l+1)],m=s(d,c);if(h<f+m){r.segment=l,r.passed=f;var v=D((h-f)/m,0,1);n(r.coords,c,d,v),p=!1;break}f+=m}if(p){var _=r.forward?a.b:a.a,g=t.vertices[_];"house"===g.type&&(r.homeTimeStart=o,function(t,e){t[0]=e[0],t[1]=e[1]}(r.coords,g.coords)),r.edge=function(t,e,i,r,n){if(0===n.edges.length||-1!==n.houseEdge&&i-(e.homeTimeStart+1e3*e.waitAtHome)>1e3*e.timeOutside)return n.houseEdge;var o=n.edges,a=Math.floor(t()*o.length);o.length>1&&o[a]===r&&(a=(a+1)%o.length);return o[a]}(e,r,o,r.edge,g),r.startTime=o,r.segment=0,r.passed=0;var y=t.edges[r.edge];r.forward=y.a===_}}(t,i.random,i.options,e,i.simulationTime)}));var e=Math.max(16,100);i.simulationTime-i.lastSpreadTime>e&&(i.spreadDisease(i.simulationTime,e),i.lastSpreadTime=i.simulationTime),i.collectStat()}i.render.render()},this.render=new B(t,e.icons),this.random=N(this.options.randomSeed),this.humans=[],this.stats=[],this.simulationTime=0,this.lastSpreadTime=0,this.paused=!1,this.speed=1,requestAnimationFrame(this.update)}return t.prototype.start=function(t,e){var i=this;this.options=t,this.stop(),fetch(t.dataUrl).then((function(t){return t.json()})).then((function(r){i.graph=function(t){return function(t){var e=0,i=0;function r(t){e=t[0]=t[0]+e,i=t[1]=t[1]+i}var n=0;function o(t){return n=t+n}t.vertices.forEach((function(e){r(e.coords),e.coords[0]=100*e.coords[0],e.coords[1]=100*e.coords[1],e.coords[0]=e.coords[0]+t.center[0],e.coords[1]=e.coords[1]+t.center[1],e.type=C(e.type),e.edges=e.edges.map(o)})),t.edges.forEach((function(e){e.type=C(e.type),e.a=o(e.a),e.b=o(e.b),void 0===e.geometry?e.geometry=[t.vertices[e.a].coords,t.vertices[e.b].coords]:e.geometry.forEach((function(e){r(e),e[0]=100*e[0],e[1]=100*e[1],e[0]=e[0]+t.center[0],e[1]=e[1]+t.center[1]}))}))}(t),t.vertices.forEach((function(e){var i=e.edges.findIndex((function(e){return"house"===t.edges[e].type}));-1!==i?(e.houseEdge=e.edges[i],e.edges.splice(i,1)):e.houseEdge=-1})),t}(r);var n=[];if(e){var o=I(e.center);i.graph.vertices.forEach((function(t,i){"null"!==t.type&&s(t.coords,o)<100*e.radius&&n.push(i)}))}else i.graph.vertices.forEach((function(t,e){"null"!==t.type&&n.push(e)}));if(n.length){for(var a=n.filter((function(t){return"house"===r.vertices[t].type})),u=0;u<t.humansCount;u++){var h=u<t.humansCount*t.humansStop,f=O(i.graph,i.random,h&&a.length?a:n,t,u<t.diseaseStartCount,h);i.humans.push(f)}i.render.setPoints(i.humans,r.min,r.max)}}))},t.prototype.stop=function(){this.render.setPoints([],[0,0],[0,0]),this.random=N(this.options.randomSeed),this.humans=[],this.stats=[],this.graph=void 0,this.simulationTime=0,this.lastSpreadTime=0,this.paused=!1,this.speed=1},t.prototype.pause=function(){this.paused=!0},t.prototype.play=function(){this.paused=!1},t.prototype.setSpeed=function(t){this.speed=t},t.prototype.getStats=function(){return this.stats},t.prototype.spreadDisease=function(t,e){var i=this,r=this.options.humanSpeed*e*2,n=this.humans,o=new d(n.filter((function(t){return t.state===F.Disease})),(function(t){return t.coords[0]}),(function(t){return t.coords[1]}),64,Int32Array);n.forEach((function(e){if(e.state===F.Virgin){var n=100*i.options.diseaseRange+r;z(e,t)&&(n=100*i.options.diseaseRange),o.within(e.coords[0],e.coords[1],n).length&&(e.state=F.Disease,e.diseaseStart=i.simulationTime)}}))},t.prototype.collectStat=function(){var t=[0,0,0];this.humans.forEach((function(e){return t[e.state]++})),this.stats.push({time:this.simulationTime,virgin:t[0],disease:t[1],immune:t[2]})},t}();function O(t,e,i,r,n,o){var a=i[Math.floor(e()*i.length)],s=t.vertices[a],u=s.edges.length?s.edges[Math.floor(e()*s.edges.length)]:s.houseEdge,h=t.edges[u].a===a,f=G(e,r.waitAtHome,r.humanDeviation),p=G(e,r.timeOutside,r.humanDeviation),l=1e3*-f-e()*r.timeOutside*1e3;return"house"===s.type&&(l=-e()*f*1e3),{coords:s.coords.slice(0),forward:h,edge:u,segment:0,passed:0,startTime:0,state:n?F.Disease:F.Virgin,diseaseStart:0,stoped:o,homeTimeStart:l,immunityAfter:G(e,r.immunityAfter,r.humanDeviation),waitAtHome:f,timeOutside:p}}function G(t,e,i){return e+(t()-.5)*e*i}function z(t,e){return t.stoped||e-t.homeTimeStart<1e3*t.waitAtHome}i.d(e,"Simulation",(function(){return U})),i.d(e,"SimulationOptions",(function(){})),i.d(e,"SimulationIcons",(function(){})),i.d(e,"SimulationStartOptions",(function(){})),i.d(e,"SimulationStat",(function(){})),i.d(e,"SimulationFilterOptions",(function(){}))}]);